# ✅ BTC-Quant Strategy — 参数与逻辑说明（给未来的你）

**版本：** 2025-11

本文件用于记录当前策略的设计原则、参数含义、敏感性分析与未来扩展方向。让你半年、一年之后回来看，也能完全理解为什么现在是这个样子，不会乱动导致性能崩掉。

---

## 🔥 策略核心思想

这套 BTC 量化策略是一个 **"4H 强趋势突破多头策略 + 日线 Regime 防呆过滤"**。

### 其本质逻辑：

1. **只做多，不做空**  
   因为 BTC 长期趋势呈上升偏差（positive drift），做空长期期望为负。

2. **只在日线大趋势为多头（BULL Regime）时开仓**  
   避免熊市震荡中无谓止损。

3. **4H 级别必须同时满足：**
   - `Price > EMA200`
   - `EMA50 > EMA200`
   - `EMA200 斜率 > 0`
   - `ATR(14)/Price > 0.75%`

4. **在满足趋势条件时，依据 V2 信号（突破 + EMA 动能 + 结构）决定是否开多。**

5. **开仓后立即设置：**
   - 止损约 `-0.8%`
   - 止盈约 `+5%`

---

## 📌 当前生产参数（strategy.json）

```json
{
  "useTrendFilter": true,
  "useV2Signal": true,
  "stopLossPct": 0.008,
  "takeProfitPct": 0.05,
  "minAtrPct": 0.0075,
  "emaFast": 50,
  "emaSlow": 200,
  "atrPeriod": 14,
  "leverageLevels": [3, 5]
}
```

---

## 🛑 参数敏感性（非常重要！防止你未来乱改）

### ✔️ （1）`minAtrPct = 0.75%` 是极度敏感参数（不要乱动！！！）

**Walk-forward 结果显示：**
- 略低一点（`0.5%`） → 立刻变成 Test 负收益
- 略高一点（`1%`） → Test 依然负收益

**👉 结论**

你现在的 `0.75%` 是非常"锋利"的阈值，一旦动就崩。必须锁死。

未来只有在你有更长时间序列（3–5 年）+ 重新做 Robust Test 时，才允许调整。

---

### ✔️ （2）SL（止损 `0.8%`）在 ±`0.1%` 范围内性能稳定

**扰动后表现：**
- `0.7%` → Test `+4.14%`
- `0.8%` → Test `+4.04%`
- `0.9%` → Test `+3.94%`

**👉 结论**

止损这个区域都可以，但 `0.8%` 作为中心值最佳，稳健、不过拟合。

**如果未来更新：**
- 不要小于 `0.6%`
- 不要大于 `1.2%`

---

### ✔️ （3）TP（止盈 `5%`）略微拉大到 `6%` 有轻微提升（+`1%`）

**扰动后：**
- `4%` → Test `+3.04%`
- `5%` → `+4.04%`
- `6%` → `+5.04%`（最好）

**但：**
- 只有一个窗口，不足以证明一定更强

**👉 结论**

先用 `5%`，未来有更多历史数据时再测试 `6%`。

---

## 🚀 Regime 过滤 —— 最重要的收益来源之一

日线做 BULL/BEAR 检测，是你减少噪音损失的关键逻辑之一。

**Regime 必须满足：**
- Daily `price > ema200`
- Daily `ema50 > ema200`
- Daily `ema200 slope > 0`

否则不允许开多（即使 4H 看起来很好）。

**👉 这一步骤是"防低胜率区间"的核心**

未来不要删，不要关。

---

## ⚙️ 使用指南（给未来跑 live signal 的你）

### ✔️ 你现在会用到 5 个脚本：

#### 1. `backtest`

```bash
npm run backtest
```

验证策略在完整历史上的表现。

#### 2. `backtest-regime`

```bash
npm run backtest-regime
```

验证"加入日线 regime 后"的版本。

#### 3. `optimizer`

```bash
npm run optimize
```

寻找 `stopLoss`、`takeProfit`、`minAtr` 的合理范围。

#### 4. `walkforward-robust`

```bash
npm run walkforward-robust
```

测试参数是否稳健（重点在 Test 段）。

#### 5. `live-cron` / `live-once`

你已经配置好了，会自动读 `strategy.json`。

---

## 🔮 未来升级路线图（写给未来你的 TODO）

1. 加过滤：4H → 1H 倍率关系（ATR fractal filter）
2. 加成交量过滤（`volume > MA50-volume`）
3. 做一个"突破失败反手空单"策略（第二代版本）
4. 做"多策略组合（Ensemble）"
5. 使用更长历史（3–5 年）重新做 Robust Test
